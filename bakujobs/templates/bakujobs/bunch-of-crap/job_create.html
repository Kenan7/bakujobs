{% extends '../minimalBase.html' %}

{% block body %}
    <div id="primary" class="content-area container" role="main">
        <div class="row">
            <div class="col-sm-12 col-md-10 col-md-offset-1">
                <article class="page type-page status-publish hentry">
                    <div class="entry-content">
                        <form method="post" id="jobForm" class="job-manager-form" data-items-url="{% url 'ajax_load_items' %}">
                            {% csrf_token %}

                            <fieldset class="fieldset-create_account_email">
                                <label for="create_account_email">Your email</label>
                                <div class="field required-field">
                                    <input type="text" class="input-text" name="create_account_email" id="create_account_email" placeholder="you@yourdomain.com" value="" maxlength="" required="">
                                </div>
                            </fieldset>

                            <!-- Job Information Fields -->

                            <fieldset class="fieldset-job_title">
                                <label for="id_name">Company Name</label>
                                <div class="field required-field">
                                    {{ form.company_name }}
                                </div>
                            </fieldset>
                            <fieldset class="fieldset-job_location">
                                <label for="job_location">Location <small>(optional)</small></label>
                                <div class="field ">
                                    {{ form.location }}
                                    <small class="description">Leave this blank if the location is not important</small>
                                </div>
                            </fieldset>
                            <fieldset class="fieldset-application">
                                <label for="application">Application email/URL</label>
                                <div class="field required-field">
                                    <input type="text" class="input-text" name="application" id="application" placeholder="Enter an email address or website URL" value="" maxlength="" required="">
                                </div>
                            </fieldset>
                            <fieldset class="fieldset-job_region">
                                <label for="job_region">Job Category</label>
                                <div class="field required-field">
                                    {{ form.category }}
                                </div>
                            </fieldset>
                            <fieldset class="fieldset-job_region">
                                <label for="job_region">Job Description</label>
                                <div class="field required-field">
                                    {{ form.job_description }}
                                </div>
                            </fieldset>

                            <fieldset class="fieldset-job_region">
                                <label for="job_region">Job Type</label>
                                <div class="field required-field">
                                    {{ form.job_type }}
                                </div>
                            </fieldset>

                            <div class="row">
                                <div class="col-6">
                                    <fieldset class="fieldset-job_region">
                                        <label for="id_min_salary" class="col-sm-3 col-md-6 control-label">Min salary:
                                        </label>
                                        <div class="field required-field">
                                            {{ form.min_salary }}
                                        </div>
                                    </fieldset>
                                </div>

                                <div class="col-6">
                                    <fieldset class="fieldset-job_region">
                                        <label for="id_max_salary" class="col-sm-3 col-md-6 control-label">Max salary:
                                        </label>
                                        <div class="field required-field">
                                            {{ form.max_salary }}
                                        </div>
                                    </fieldset>
                                </div>
                            </div>

                            <fieldset class="fieldset-job_region">
                                <label for="id_gender" class="col-sm-3 control-label">Gender</label>
                                <div class="field required-field">
                                    {{ form.gender }}
                                </div>
                            </fieldset>


                            <fieldset class="fieldset-job_region">
                                <label for="id_gender" class="col-sm-3 control-label">Description</label>
                                <div class="field required-field">
                                    {{ form.description | safe }}
                                </div>
                            </fieldset>


                            <fieldset class="fieldset-job_region">
                                <label for="id_gender" class="col-sm-3 control-label">Website</label>
                                <div class="field required-field">
                                {{ form.website }}
                                </div>
                            </fieldset>


                            <fieldset class="fieldset-job_region">
                                <label for="id_gender" class="col-sm-3 control-label">E-mail</label>
                                <div class="field required-field">
                                {{ form.email }}
                                </div>
                            </fieldset>


                            <fieldset class="fieldset-job_region">
                                <label for="id_gender" class="col-sm-3 control-label">Phone Number</label>
                                <div class="field required-field">
                                {{ form.phone }}
                                </div>
                            </fieldset>
                    </form>
            </div>
            </article><!-- #post -->
        </div>
    </div>

    </div>
    {% include 'bakujobs/js.html' %}
{% endblock %}

{% block script %}
    <script>
        $(document).ready(function (e) {
            $("#id_category").change(function(e) {
                var categoryId = $(this).val();
                var url = $("#jobForm").attr("data-items-url");

                $.ajax({
                    url: url,
                    type: "GET",
                    data: {
                        'category': categoryId
                    },
                    success: function (data) {
                        $("#id_job_description").html(data);
                    },
                    error: function (xhr, errmsg, err) {
                        console.log(xhr, errmsg, err);
                    }
                });
            });
        });
    </script>
    <script>
        // using jQuery
        function getCookie(name) {
            var cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                var cookies = document.cookie.split(';');
                for (var i = 0; i < cookies.length; i++) {
                    var cookie = jQuery.trim(cookies[i]);
                    // Does this cookie string begin with the name we want?
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        var csrftoken = getCookie('csrftoken');

        function csrfSafeMethod(method) {
            // these HTTP methods do not require CSRF protection
            return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
        }
        $.ajaxSetup({
            beforeSend: function(xhr, settings) {
                if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                    xhr.setRequestHeader("X-CSRFToken", csrftoken);
                }
            }
        });
    </script>
{% endblock %}
